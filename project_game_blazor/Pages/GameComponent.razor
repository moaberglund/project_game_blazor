@page "/tictactoe"

@using DT071G_Project_TicTacToe.Components.Models

<h1 class="text-center">Tic Tac Toe</h1>


@if (Game != null)
{
    <div class="score">
    <h2 class="text-center">Current score: </h2>
        <div class="scoretable">
            <h3 class="playerO">Noughts: @Game.OWinner </h3> <h3 class="playerX"> Crosses: @Game.XWinner</h3>
        </div>
    </div>


    <div class="game">
    @*nästlad for-loop för att skapa rutorna*@
    @for (var tt = 1; tt <= 3; tt++)
    {
       
            @for (var vv = 1; vv <= 3; vv++)
            {
                //Skapa en ny instans av Square
                var square = Game.Squares[(((tt -1) *3 ) +vv)-1];

                <SquareComponent Square="@square" ClickParameter="@(e => SquareClick(e, square))"></SquareComponent>
            
            }
    }

    </div>
    <div class="footer">
        <button @onclick="@Reset" class="btn btn-dark resetBtn">Reset Game</button>
        
        @*Meddela vinst*@
        @if (Game.Winner.HasValue)
        {
        <p class="win">Player "@Game.Winner.Value" has won the game!</p>
        }
    </div>
}


@code {

    //Skapa instans av Game
    public Game Game { get; set; }

    //Skapa initiering
    protected override async Task OnInitializedAsync()
    {

        //skapa ny instans av Game - skapa rutorna
        Game = new Game();


        await base.OnInitializedAsync();
    }

    public void SquareClick(MouseEventArgs mouseEventArgs, Square square)
    {

        //Om ingen har vunnit
        if (!Game.Winner.HasValue)
        {
            //vilken har blivit markerad
            square.Mark = Game.NextTurn;
            //Ändra spelare
            Game.Next();

            //Kolla efter ändringar
            StateHasChanged();
        }
    }   

    // onclick reset game
    public void Reset(MouseEventArgs mouseEventArgs)
    {
        Game.ResetGame();
        StateHasChanged();
    }
}
